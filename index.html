<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa de Tiendas</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <header class="bg-blue-600 text-white p-4 text-center text-xl font-bold">
    Portal de Tiendas Populares
  </header>

  <main class="p-4">
    <!-- Buscador -->
    <input id="search" type="text" placeholder="Buscar tienda..." 
      class="w-full p-2 border rounded mb-4">

    <!-- Mapa -->
    <div id="map" class="w-full h-[500px] rounded-lg shadow"></div>
  </main>

  <script>
    // Lista masiva de tiendas en JSON
    const tiendas = [
      {
        "nombre": "Moda Gamarra",
        "descripcion": "Ropa al por mayor y menor.",
        "direccion": "Jr. Gamarra 123, La Victoria",
        "telefono": "987654321",
        "horario": "Lun-Sab 9am-7pm",
        "whatsapp": "https://wa.me/51987654321",
        "facebook": "https://facebook.com/modagamarra",
        "instagram": "https://instagram.com/modagamarra",
        "tiktok": "https://tiktok.com/@modagamarra",
        "lat": -12.0645,
        "lng": -77.0147
      },
      {
        "nombre": "Polvos Azules",
        "descripcion": "TecnologÃ­a, ropa y accesorios.",
        "direccion": "Av. Garcilaso de la Vega 1251, Lima",
        "telefono": "912345678",
        "horario": "Todos los dÃ­as 10am-8pm",
        "whatsapp": "https://wa.me/51912345678",
        "facebook": "https://facebook.com/polvosazules",
        "instagram": "https://instagram.com/polvosazules",
        "tiktok": "https://tiktok.com/@polvosazules",
        "lat": -12.0584,
        "lng": -77.034
      },
      {
        "nombre": "GalerÃ­a Arenales",
        "descripcion": "Moda urbana y cultura otaku.",
        "direccion": "Av. Arenales 1737, Lince",
        "telefono": "999888777",
        "horario": "Lun-Dom 10am-7pm",
        "whatsapp": "https://wa.me/51999888777",
        "facebook": "https://facebook.com/arenales",
        "instagram": "https://instagram.com/arenales",
        "tiktok": "https://tiktok.com/@arenales",
        "lat": -12.0851,
        "lng": -77.033
      },
      {
        "nombre": "Polvos Rosados",
        "descripcion": "Juguetes, ropa y artÃ­culos varios.",
        "direccion": "Av. AviaciÃ³n 2250, San Borja",
        "telefono": "955123456",
        "horario": "Lun-Sab 10am-8pm",
        "whatsapp": "https://wa.me/51955123456",
        "facebook": "https://facebook.com/polvosrosados",
        "instagram": "https://instagram.com/polvosrosados",
        "tiktok": "https://tiktok.com/@polvosrosados",
        "lat": -12.0982,
        "lng": -77.0025
      }
    ];

    // Inicializar el mapa
    const map = L.map('map').setView([-12.0621, -77.0365], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // FunciÃ³n para generar el contenido del popup
    function generarPopup(tienda) {
      return `
        <div class="text-sm">
          <h3 class="font-bold text-lg">${tienda.nombre}</h3>
          <p>${tienda.descripcion}</p>
          <p><b>DirecciÃ³n:</b> ${tienda.direccion}</p>
          <p><b>TelÃ©fono:</b> ${tienda.telefono}</p>
          <p><b>Horario:</b> ${tienda.horario}</p>
          <p><a href="${tienda.whatsapp}" target="_blank">ðŸ“± WhatsApp</a></p>
          <p><a href="${tienda.facebook}" target="_blank">ðŸ“˜ Facebook</a></p>
          <p><a href="${tienda.instagram}" target="_blank">ðŸ“· Instagram</a></p>
          <p><a href="${tienda.tiktok}" target="_blank">ðŸŽµ TikTok</a></p>
        </div>
      `;
    }

    // Agregar los marcadores con todos los datos en el popup
    tiendas.forEach(tienda => {
      L.marker([tienda.lat, tienda.lng]).addTo(map)
        .bindPopup(generarPopup(tienda));
    });

    // Buscador
    document.getElementById('search').addEventListener('input', (e) => {
      const texto = e.target.value.toLowerCase();
      const resultado = tiendas.find(t => t.nombre.toLowerCase().includes(texto));
      if (resultado) {
        map.setView([resultado.lat, resultado.lng], 16);
        L.popup()
          .setLatLng([resultado.lat, resultado.lng])
          .setContent(generarPopup(resultado))
          .openOn(map);
      }
    });
  </script>
</body>
</html>
